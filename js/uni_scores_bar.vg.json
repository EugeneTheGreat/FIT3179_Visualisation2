{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "title": "Scores of World Ranked Universities",
    "description": "Scores of World Ranked Universities",
    "data": {"url": "https://raw.githubusercontent.com/EugeneTheGreat/FIT3179_Visualisation2/main/data/rankings_cleaned_merged.csv"},
    "params": [
        { "name": "year_selection", 
          "value": 2023, 
          "bind": {
            "input": "range", 
            "min": 2011, 
            "max": 2023, 
            "step": 1, 
            "name": "Select Year: " 
        }}
    ],
    "encoding": {
        "x": {
            "field": "scores_overall",
            "type": "quantitative",
            "title": "Overall Score"
        },
        "y": {
            "field": "name",
            "type": "nominal",
            "title": "University",
            "sort": {"order": "descending"}
        }
    },
    "transform": [
        {
            "filter": "datum.year == year_selection"
        }
    ],
    "layer": [
        {
            "mark": {
                "type": "bar",
                "cornerRadiusEnd": 1
            },
            "encoding": {
                "tooltip": [
                    { "field" : "name", "type" : "nominal", "title": "University" },
                    { "field" : "location", "type" : "nominal", "title": "Location" },
                    { "field" : "scores_overall", "type" : "quantitative", "title": "Overall Score" }
                ]
            }
        },
        {
            "mark": {
                "type": "text",
                "align": "left",
                "baseline": "middle",
                "dx": 50,
                "fontSize": 11.5,
                "fontStyle": "italic"
            },
            "encoding": {
                "text": {"field": "scores_overall", "type": "quantitative"},
                "opacity": {
                    "condition" : {
                        "test" : "datum.rank == '1' || datum.rank == '2' || datum.rank == '3'",
                        "value" : 1
                        },
                        "value" : 0
                }
            }
        }
    ]
    
  }